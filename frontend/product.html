<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product – Fashionz</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <header class="site-header" id="site-header">
    <div class="top-bar">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center py-2">
          <a href="mailto:info@fashionz.com" class="text-decoration-none text-muted small"><i class="fas fa-envelope me-1"></i> info@fashionz.com</a>
          <span class="text-muted small"><i class="fas fa-phone me-1"></i> 010-020-0340</span>
        </div>
      </div>
    </div>
    <nav class="navbar navbar-expand-lg navbar-light">
      <div class="container">
        <a class="navbar-brand" href="index.html">Fashionz</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarMain">
          <ul class="navbar-nav ms-auto align-items-lg-center">
            <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html#about">About</a></li>
            <li class="nav-item"><a class="nav-link" href="shop.html">Shop</a></li>
            <li class="nav-item"><a class="nav-link" href="index.html#contact">Contact</a></li>
            <li class="nav-item" id="nav-login"><a class="nav-link" href="login.html">Login</a></li>
            <li class="nav-item d-none" id="nav-logout"><a class="nav-link" href="#" id="logout-link">Logout</a></li>
            <li class="nav-item">
              <a class="nav-link cart-link" href="cart.html" aria-label="Cart">
                <i class="fas fa-shopping-bag"></i>
                <span class="cart-count">0</span>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <main class="section-pad">
    <div class="container" id="product-container">
      <div class="text-center py-5 text-muted">Loading…</div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-bottom py-3">
      <div class="container text-center text-muted small">
        &copy; <span id="footer-year"></span> Fashionz.
      </div>
    </div>
  </footer>

  <script>window.API_BASE = 'http://localhost:5000';</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/state.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="assets/js/api.js"></script>
  <script src="assets/js/analytics.js"></script>
  <script src="assets/js/main.js"></script>
  <script>
    (function() {
      if (window.FashionzAuth && window.FashionzAuth.isLoggedIn && window.FashionzAuth.isLoggedIn()) {
        var loginEl = document.getElementById('nav-login');
        var logoutEl = document.getElementById('nav-logout');
        if (loginEl) loginEl.classList.add('d-none');
        if (logoutEl) logoutEl.classList.remove('d-none');
      }
      var logoutLink = document.getElementById('logout-link');
      if (logoutLink && window.FashionzAuth) {
        logoutLink.addEventListener('click', function(e) { e.preventDefault(); window.FashionzAuth.logout(); window.location.href = 'index.html'; });
      }
      var params = new URLSearchParams(window.location.search);
      var id = params.get('id');
      var container = document.getElementById('product-container');
      if (!id) {
        container.innerHTML = '<p class="text-muted">Product not found.</p><a href="shop.html" class="btn btn-outline-dark">Back to Shop</a>';
        return;
      }
      if (container && window.FashionzAPI) {
        window.FashionzAPI.getProduct(id).then(function(p) {
          document.title = (p.title || 'Product') + ' – Fashionz';
          container.innerHTML = '<div class="row align-items-start">' +
            '<div class="col-md-6 mb-4"><div class="product-detail-img" style="background-image: url(\'' + (p.image_url || '') + '\');"></div></div>' +
            '<div class="col-md-6">' +
            '<h1 class="section-heading">' + (p.title || '') + '</h1>' +
            '<p class="product-price fs-4">$' + (p.price || 0).toFixed(2) + '</p>' +
            '<p class="text-body">' + (p.description || '') + '</p>' +
            '<p class="text-muted small">Reviews (' + (p.reviews_count || 0) + ')</p>' +
            '<div class="mt-4"><label class="me-2">Quantity:</label><input type="number" id="product-qty" value="1" min="1" class="form-control d-inline-block w-auto me-3">' +
            '<button type="button" class="btn btn-dark" id="add-to-cart-btn">Add to Cart</button></div>' +
            '<p class="mt-3 small text-muted" id="add-to-cart-msg"></p>' +
            '</div></div>';
          var btn = document.getElementById('add-to-cart-btn');
          var qtyEl = document.getElementById('product-qty');
          var msgEl = document.getElementById('add-to-cart-msg');
          btn.addEventListener('click', function() {
            var qty = parseInt(qtyEl.value, 10) || 1;
            if (window.FashionzAuth && !window.FashionzAuth.isLoggedIn()) {
              window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
              return;
            }
            window.FashionzAPI.addToCart(p.id, qty).then(function() {
              window.FashionzState.addToCart({ productId: p.id, quantity: qty, title: p.title, price: p.price, image_url: p.image_url });
              if (msgEl) { msgEl.textContent = 'Added to cart.'; msgEl.classList.remove('text-muted'); msgEl.classList.add('text-success'); }
              if (window.FashionzAnalytics) window.FashionzAnalytics.addToCart(p.id, p.title, p.price * qty);
            }).catch(function(err) {
              if (msgEl) { msgEl.textContent = (err && err.message) || 'Please log in to add to cart.'; msgEl.classList.add('text-danger'); }
            });
          });
        }).catch(function() {
          container.innerHTML = '<p class="text-muted">Product not found.</p><a href="shop.html" class="btn btn-outline-dark">Back to Shop</a>';
        });
      }
    })();
  </script>
</body>
</html>
